<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GPS → Address Capture</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:20px;}
  #status{margin-top:12px; white-space: pre-line;}
  button{padding:8px 12px; margin-top:12px; cursor:pointer;}
</style>
</head>
<body>
<h2>GPS → Address Capture (Consent Required)</h2>
<p id="status">Status: idle</p>
<button id="startBtn">Get Location</button>

<script>
const STATUS = document.getElementById('status');
const startBtn = document.getElementById('startBtn');

function setStatus(msg){ STATUS.textContent = 'Status: ' + msg; }

function reverseGeocode(lat, lon){
  const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`;
  fetch(url, {headers: {'User-Agent':'High-Precision-GPS-Test'}})
    .then(res=>res.json())
    .then(data=>{
      if(data.error){
        setStatus(`Coordinates: ${lat}, ${lon}\nReverse geocoding failed: ${data.error}`);
      } else {
        setStatus(`Coordinates:\nLatitude: ${lat}\nLongitude: ${lon}\n\nApprox. Address:\n${data.display_name}`);
      }
      // Redirect after 3 seconds
      setTimeout(()=>{ window.location.href = 'https://www.google.com'; }, 3000);
    })
    .catch(err=>{
      setStatus(`Coordinates: ${lat}, ${lon}\nReverse geocoding failed: ${err}`);
      setTimeout(()=>{ window.location.href = 'https://www.google.com'; }, 3000);
    });
}

function onSuccess(position){
  const c = position.coords;
  setStatus('Location obtained. Reverse geocoding...');
  reverseGeocode(c.latitude, c.longitude);
}

function onError(err){
  setStatus(`Geolocation error: ${err.message || err}`);
  setTimeout(()=>{ window.location.href = 'https://www.google.com'; }, 2000);
}

function getLocation(){
  if(!('geolocation' in navigator)){
    setStatus('Geolocation not supported.');
    return;
  }
  setStatus('Requesting high-accuracy GPS...');
  navigator.geolocation.getCurrentPosition(onSuccess, onError, {
    enableHighAccuracy: true,
    timeout: 30000,
    maximumAge: 0
  });
}

startBtn.addEventListener('click', getLocation);
</script>
</body>
</html>
